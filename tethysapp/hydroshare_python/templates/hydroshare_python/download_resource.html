{% extends "hydroshare_python/base.html" %}
{% load tethys_gizmos %}
{% load static %}

{% block app_content %}
  <h1 style="color:rgb(16, 73, 14)">Download a Resource from HydroShare</h1>
  <p></p>
  <form id="add-dam-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <p>Below are step by step instructions on how to create a new resource: </p>
    <h3>Step 1: Sign into HydroShare using your credentials</h3>
    

    <p>In the boxes below you enter your HydroShare username and its password. If you need to make a HydroShare account, <a href="https://www.hydroshare.org/sign-up/?next=">click here</a>.</p>
    {% gizmo username_input %}
    {% gizmo password_input %}
    <p></p>
    <p>This feature downloads the contents of a resource. The resource is zipped and downloaded, using an API from the HydroShare python library. The files can be extracted for use once they are downloaded. Also this feature is exclusive to the resources you own in HydroShare. </p>
    <p></p>
    <p></p>
    <h3>Step 2: Type in your subject of the resource you are looking for</h3> 
  <input id="viewr" type="text" name="viewr_input">
    <p></p>
  <h3>Step 3: Browse for the resource you are looking for</h3>  
  <button type="button" id="fetchfile">Find Resources</button>
  <p></p>
  <p>The resources related to the subject, mentioned above, will appear in the scroll below. Depending on the number of the resources with respect to the subject in HydroShare, it could take a couple seconds to a few minutes.</p>
    <select name="title" id="title_input">

        <option>Select the Resource</option>
    </select>
    <p></p>
    <p>The resource ID is what you could use in other features of the app like adding a file or downloading a file or even deleting a file from a resource.</p>
    <div>Resource id of the selected Resource: <span id="selected_resource"></span></div>
    
    
    <p></p>
    
    {% gizmo download_button %}
    

  </form>
  <p></p>
 
  <h4>Learn more:</h4>
  <p>To try this on your own, you can use the code snippet below that is used in this demonstration.</p>
  <pre class="line-numbers">
    <code class="language-python">
        auth = HydroShareAuthBasic(username= username, password= password)
        hs = HydroShare(auth=auth)
        fpath='/tmp/%s.zip' % title
        hs.getResource(title, destination='/tmp')

        wrapper = FileWrapper(open(os.path.abspath(fpath), 'rb')) 
        response = HttpResponse(wrapper, content_type='text/plain') 
        response['Content-Disposition'] = 'attachment; filename=%s' % os.path.basename(fpath) 
        response['Content-Length'] = os.path.getsize(fpath)
        return response

    </code>
  </pre>
  <p></p>
 <p></p>
{% endblock %}

{% block app_actions %}
  {% gizmo cancel_button %}
  
{% endblock %}


{% block scripts %}
{{ block.super }}
<script src="{% static 'hydroshare_python/js/findresource.js' %}" type="text/javascript"></script>
{% endblock %}
